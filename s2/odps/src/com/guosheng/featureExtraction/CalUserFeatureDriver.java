package com.guosheng.featureExtraction;

import com.aliyun.odps.OdpsException;
import com.aliyun.odps.data.TableInfo;
import com.aliyun.odps.mapred.JobClient;
import com.aliyun.odps.mapred.RunningJob;
import com.aliyun.odps.mapred.conf.JobConf;
import com.aliyun.odps.mapred.utils.InputUtils;
import com.aliyun.odps.mapred.utils.OutputUtils;
import com.aliyun.odps.mapred.utils.SchemaUtils;

public class CalUserFeatureDriver {

	public static void main(String[] args) throws OdpsException {
		// 使用SQLTask创建输出表
//		Account account = new AliyunAccount("OBNp6MB6cfSwNeCq",
//				"BiSNYpp40o47agSE74raqPgGNgA0gB");
//		Odps odps = new Odps(account);
//		if (!odps.tables().exists("t_4p1_feature_pair_user")) {
//			String sql = "create table t_4p1_feature_pair_user (flag bigint, user_id string, brand_id string, f1_0_add double, f1_1_add double, f1_2_add double, f1_3_add double, f2_0_add double, f2_1_add double, f2_2_add double, f2_3_add double, f3_0_add double, f3_1_add double, f3_2_add double, f3_3_add double, f4_0_add double, f4_1_add double, f4_2_add double, f4_3_add double, f5_0_add double, f5_1_add double, f5_2_add double, f5_3_add double, f6_0_add double, f6_1_add double, f6_2_add double, f6_3_add double, f7_0_add double, f7_1_add double, f7_2_add double, f7_3_add double, f8_0_add double, f8_1_add double, f8_2_add double, f8_3_add double, f9_0_add double, f9_1_add double, f9_2_add double, f9_3_add double, f10_0_add double, f10_1_add double, f10_2_add double, f10_3_add double, f11_0_add double, f11_1_add double, f11_2_add double, f11_3_add double, f12_0_add double, f12_1_add double, f12_2_add double, f12_3_add double, f13_0_add double, f13_1_add double, f13_2_add double, f13_3_add double, f14_0_add double, f14_1_add double, f14_2_add double, f14_3_add double, f15_0_add double, f15_1_add double, f15_2_add double, f15_3_add double, f16_0_add double, f16_1_add double, f16_2_add double, f16_3_add double, click_before_buy double, favorite_before_buy double, cart_before_buy double, click_after_buy double, favorite_after_buy double, cart_after_buy double, time_between_buy double, time_after_buy double, avg_click_before_buy double, avg_favorite_before_buy double, avg_cart_before_buy double, avg_time_between_buy double, user_click double, user_buy double, user_favorite double, user_cart double, user_click_brand_num double, user_buy_brand_num double, user_favorite_brand_num double, user_cart_brand_num double, user_effective_click double, user_effective_favorite double, user_effective_cart double, user_time_between_buy double, user_avg_click_with_buy double, user_avg_favorite_with_buy double, user_avg_cart_with_buy double, user_avg_time_between_buy double)";
//			Instance instance = SQLTask.run(odps, sql);
//			// TODO
//		}
//		create table t_4p1_feature_pair_user_14 (flag bigint, user_id string, brand_id string, f1_0_add double, f1_1_add double, f1_2_add double, f1_3_add double, f2_0_add double, f2_1_add double, f2_2_add double, f2_3_add double, f3_0_add double, f3_1_add double, f3_2_add double, f3_3_add double, f4_0_add double, f4_1_add double, f4_2_add double, f4_3_add double, f5_0_add double, f5_1_add double, f5_2_add double, f5_3_add double, f6_0_add double, f6_1_add double, f6_2_add double, f6_3_add double, f7_0_add double, f7_1_add double, f7_2_add double, f7_3_add double, f8_0_add double, f8_1_add double, f8_2_add double, f8_3_add double, f9_0_add double, f9_1_add double, f9_2_add double, f9_3_add double, f10_0_add double, f10_1_add double, f10_2_add double, f10_3_add double, f11_0_add double, f11_1_add double, f11_2_add double, f11_3_add double, f12_0_add double, f12_1_add double, f12_2_add double, f12_3_add double, f13_0_add double, f13_1_add double, f13_2_add double, f13_3_add double, f14_0_add double, f14_1_add double, f14_2_add double, f14_3_add double, click_before_buy double, favorite_before_buy double, cart_before_buy double, click_after_buy double, favorite_after_buy double, cart_after_buy double, time_between_buy double, time_after_buy double, avg_click_before_buy double, avg_favorite_before_buy double, avg_cart_before_buy double, avg_time_between_buy double, user_click double, user_buy double, user_favorite double, user_cart double, user_click_brand_num double, user_buy_brand_num double, user_favorite_brand_num double, user_cart_brand_num double, user_effective_click double, user_effective_favorite double, user_effective_cart double, user_time_between_buy double, user_avg_click_with_buy double, user_avg_favorite_with_buy double, user_avg_cart_with_buy double, user_avg_time_between_buy double)"
//		create table t_4p1_feature_pair_user_12 (flag bigint, user_id string, brand_id string, f1_0_add double, f1_1_add double, f1_2_add double, f1_3_add double, f2_0_add double, f2_1_add double, f2_2_add double, f2_3_add double, f3_0_add double, f3_1_add double, f3_2_add double, f3_3_add double, f4_0_add double, f4_1_add double, f4_2_add double, f4_3_add double, f5_0_add double, f5_1_add double, f5_2_add double, f5_3_add double, f6_0_add double, f6_1_add double, f6_2_add double, f6_3_add double, f7_0_add double, f7_1_add double, f7_2_add double, f7_3_add double, f8_0_add double, f8_1_add double, f8_2_add double, f8_3_add double, f9_0_add double, f9_1_add double, f9_2_add double, f9_3_add double, f10_0_add double, f10_1_add double, f10_2_add double, f10_3_add double, f11_0_add double, f11_1_add double, f11_2_add double, f11_3_add double, f12_0_add double, f12_1_add double, f12_2_add double, f12_3_add double, click_before_buy double, favorite_before_buy double, cart_before_buy double, click_after_buy double, favorite_after_buy double, cart_after_buy double, time_between_buy double, time_after_buy double, avg_click_before_buy double, avg_favorite_before_buy double, avg_cart_before_buy double, avg_time_between_buy double, user_click double, user_buy double, user_favorite double, user_cart double, user_click_brand_num double, user_buy_brand_num double, user_favorite_brand_num double, user_cart_brand_num double, user_effective_click double, user_effective_favorite double, user_effective_cart double, user_time_between_buy double, user_avg_click_with_buy double, user_avg_favorite_with_buy double, user_avg_cart_with_buy double, user_avg_time_between_buy double)

		
		JobConf job = new JobConf();
		job.setInt("pairFeatureLength", 22);
		String schemaStr24 = "brand_id:string,f1_0:bigint,f1_1:bigint,f1_2:bigint,f1_3:bigint,f2_0:bigint,f2_1:bigint,f2_2:bigint,f2_3:bigint,f3_0:bigint,f3_1:bigint,f3_2:bigint,f3_3:bigint,f4_0:bigint,f4_1:bigint,f4_2:bigint,f4_3:bigint,f5_0:bigint,f5_1:bigint,f5_2:bigint,f5_3:bigint,f6_0:bigint,f6_1:bigint,f6_2:bigint,f6_3:bigint,f7_0:bigint,f7_1:bigint,f7_2:bigint,f7_3:bigint,f8_0:bigint,f8_1:bigint,f8_2:bigint,f8_3:bigint,f9_0:bigint,f9_1:bigint,f9_2:bigint,f9_3:bigint,f10_0:bigint,f10_1:bigint,f10_2:bigint,f10_3:bigint,f11_0:bigint,f11_1:bigint,f11_2:bigint,f11_3:bigint,f12_0:bigint,f12_1:bigint,f12_2:bigint,f12_3:bigint,f13_0:bigint,f13_1:bigint,f13_2:bigint,f13_3:bigint,f14_0:bigint,f14_1:bigint,f14_2:bigint,f14_3:bigint,f15_0:bigint,f15_1:bigint,f15_2:bigint,f15_3:bigint,f16_0:bigint,f16_1:bigint,f16_2:bigint,f16_3:bigint,f17_0:bigint,f17_1:bigint,f17_2:bigint,f17_3:bigint,f18_0:bigint,f18_1:bigint,f18_2:bigint,f18_3:bigint,f19_0:bigint,f19_1:bigint,f19_2:bigint,f19_3:bigint,f20_0:bigint,f20_1:bigint,f20_2:bigint,f20_3:bigint,f21_0:bigint,f21_1:bigint,f21_2:bigint,f21_3:bigint,f22_0:bigint,f22_1:bigint,f22_2:bigint,f22_3:bigint,f23_0:bigint,f23_1:bigint,f23_2:bigint,f23_3:bigint,f24_0:bigint,f24_1:bigint,f24_2:bigint,f24_3:bigint,click_before_buy:double,favorite_before_buy:double,cart_before_buy:double,click_after_buy:double,favorite_after_buy:double,cart_after_buy:double,time_between_buy:double,time_after_buy:double";
		String schemaStr23 = "brand_id:string,f1_0:bigint,f1_1:bigint,f1_2:bigint,f1_3:bigint,f2_0:bigint,f2_1:bigint,f2_2:bigint,f2_3:bigint,f3_0:bigint,f3_1:bigint,f3_2:bigint,f3_3:bigint,f4_0:bigint,f4_1:bigint,f4_2:bigint,f4_3:bigint,f5_0:bigint,f5_1:bigint,f5_2:bigint,f5_3:bigint,f6_0:bigint,f6_1:bigint,f6_2:bigint,f6_3:bigint,f7_0:bigint,f7_1:bigint,f7_2:bigint,f7_3:bigint,f8_0:bigint,f8_1:bigint,f8_2:bigint,f8_3:bigint,f9_0:bigint,f9_1:bigint,f9_2:bigint,f9_3:bigint,f10_0:bigint,f10_1:bigint,f10_2:bigint,f10_3:bigint,f11_0:bigint,f11_1:bigint,f11_2:bigint,f11_3:bigint,f12_0:bigint,f12_1:bigint,f12_2:bigint,f12_3:bigint,f13_0:bigint,f13_1:bigint,f13_2:bigint,f13_3:bigint,f14_0:bigint,f14_1:bigint,f14_2:bigint,f14_3:bigint,f15_0:bigint,f15_1:bigint,f15_2:bigint,f15_3:bigint,f16_0:bigint,f16_1:bigint,f16_2:bigint,f16_3:bigint,f17_0:bigint,f17_1:bigint,f17_2:bigint,f17_3:bigint,f18_0:bigint,f18_1:bigint,f18_2:bigint,f18_3:bigint,f19_0:bigint,f19_1:bigint,f19_2:bigint,f19_3:bigint,f20_0:bigint,f20_1:bigint,f20_2:bigint,f20_3:bigint,f21_0:bigint,f21_1:bigint,f21_2:bigint,f21_3:bigint,f22_0:bigint,f22_1:bigint,f22_2:bigint,f22_3:bigint,f23_0:bigint,f23_1:bigint,f23_2:bigint,f23_3:bigint,click_before_buy:double,favorite_before_buy:double,cart_before_buy:double,click_after_buy:double,favorite_after_buy:double,cart_after_buy:double,time_between_buy:double,time_after_buy:double";
		String schemaStr22 = "brand_id:string,f1_0:bigint,f1_1:bigint,f1_2:bigint,f1_3:bigint,f2_0:bigint,f2_1:bigint,f2_2:bigint,f2_3:bigint,f3_0:bigint,f3_1:bigint,f3_2:bigint,f3_3:bigint,f4_0:bigint,f4_1:bigint,f4_2:bigint,f4_3:bigint,f5_0:bigint,f5_1:bigint,f5_2:bigint,f5_3:bigint,f6_0:bigint,f6_1:bigint,f6_2:bigint,f6_3:bigint,f7_0:bigint,f7_1:bigint,f7_2:bigint,f7_3:bigint,f8_0:bigint,f8_1:bigint,f8_2:bigint,f8_3:bigint,f9_0:bigint,f9_1:bigint,f9_2:bigint,f9_3:bigint,f10_0:bigint,f10_1:bigint,f10_2:bigint,f10_3:bigint,f11_0:bigint,f11_1:bigint,f11_2:bigint,f11_3:bigint,f12_0:bigint,f12_1:bigint,f12_2:bigint,f12_3:bigint,f13_0:bigint,f13_1:bigint,f13_2:bigint,f13_3:bigint,f14_0:bigint,f14_1:bigint,f14_2:bigint,f14_3:bigint,f15_0:bigint,f15_1:bigint,f15_2:bigint,f15_3:bigint,f16_0:bigint,f16_1:bigint,f16_2:bigint,f16_3:bigint,f17_0:bigint,f17_1:bigint,f17_2:bigint,f17_3:bigint,f18_0:bigint,f18_1:bigint,f18_2:bigint,f18_3:bigint,f19_0:bigint,f19_1:bigint,f19_2:bigint,f19_3:bigint,f20_0:bigint,f20_1:bigint,f20_2:bigint,f20_3:bigint,f21_0:bigint,f21_1:bigint,f21_2:bigint,f21_3:bigint,f22_0:bigint,f22_1:bigint,f22_2:bigint,f22_3:bigint,click_before_buy:double,favorite_before_buy:double,cart_before_buy:double,click_after_buy:double,favorite_after_buy:double,cart_after_buy:double,time_between_buy:double,time_after_buy:double";
		String schemaStr21 = "brand_id:string,f1_0:bigint,f1_1:bigint,f1_2:bigint,f1_3:bigint,f2_0:bigint,f2_1:bigint,f2_2:bigint,f2_3:bigint,f3_0:bigint,f3_1:bigint,f3_2:bigint,f3_3:bigint,f4_0:bigint,f4_1:bigint,f4_2:bigint,f4_3:bigint,f5_0:bigint,f5_1:bigint,f5_2:bigint,f5_3:bigint,f6_0:bigint,f6_1:bigint,f6_2:bigint,f6_3:bigint,f7_0:bigint,f7_1:bigint,f7_2:bigint,f7_3:bigint,f8_0:bigint,f8_1:bigint,f8_2:bigint,f8_3:bigint,f9_0:bigint,f9_1:bigint,f9_2:bigint,f9_3:bigint,f10_0:bigint,f10_1:bigint,f10_2:bigint,f10_3:bigint,f11_0:bigint,f11_1:bigint,f11_2:bigint,f11_3:bigint,f12_0:bigint,f12_1:bigint,f12_2:bigint,f12_3:bigint,f13_0:bigint,f13_1:bigint,f13_2:bigint,f13_3:bigint,f14_0:bigint,f14_1:bigint,f14_2:bigint,f14_3:bigint,f15_0:bigint,f15_1:bigint,f15_2:bigint,f15_3:bigint,f16_0:bigint,f16_1:bigint,f16_2:bigint,f16_3:bigint,f17_0:bigint,f17_1:bigint,f17_2:bigint,f17_3:bigint,f18_0:bigint,f18_1:bigint,f18_2:bigint,f18_3:bigint,f19_0:bigint,f19_1:bigint,f19_2:bigint,f19_3:bigint,f20_0:bigint,f20_1:bigint,f20_2:bigint,f20_3:bigint,f21_0:bigint,f21_1:bigint,f21_2:bigint,f21_3:bigint,click_before_buy:double,favorite_before_buy:double,cart_before_buy:double,click_after_buy:double,favorite_after_buy:double,cart_after_buy:double,time_between_buy:double,time_after_buy:double";
		String schemaStr20 = "brand_id:string,f1_0:bigint,f1_1:bigint,f1_2:bigint,f1_3:bigint,f2_0:bigint,f2_1:bigint,f2_2:bigint,f2_3:bigint,f3_0:bigint,f3_1:bigint,f3_2:bigint,f3_3:bigint,f4_0:bigint,f4_1:bigint,f4_2:bigint,f4_3:bigint,f5_0:bigint,f5_1:bigint,f5_2:bigint,f5_3:bigint,f6_0:bigint,f6_1:bigint,f6_2:bigint,f6_3:bigint,f7_0:bigint,f7_1:bigint,f7_2:bigint,f7_3:bigint,f8_0:bigint,f8_1:bigint,f8_2:bigint,f8_3:bigint,f9_0:bigint,f9_1:bigint,f9_2:bigint,f9_3:bigint,f10_0:bigint,f10_1:bigint,f10_2:bigint,f10_3:bigint,f11_0:bigint,f11_1:bigint,f11_2:bigint,f11_3:bigint,f12_0:bigint,f12_1:bigint,f12_2:bigint,f12_3:bigint,f13_0:bigint,f13_1:bigint,f13_2:bigint,f13_3:bigint,f14_0:bigint,f14_1:bigint,f14_2:bigint,f14_3:bigint,f15_0:bigint,f15_1:bigint,f15_2:bigint,f15_3:bigint,f16_0:bigint,f16_1:bigint,f16_2:bigint,f16_3:bigint,f17_0:bigint,f17_1:bigint,f17_2:bigint,f17_3:bigint,f18_0:bigint,f18_1:bigint,f18_2:bigint,f18_3:bigint,f19_0:bigint,f19_1:bigint,f19_2:bigint,f19_3:bigint,f20_0:bigint,f20_1:bigint,f20_2:bigint,f20_3:bigint,click_before_buy:double,favorite_before_buy:double,cart_before_buy:double,click_after_buy:double,favorite_after_buy:double,cart_after_buy:double,time_between_buy:double,time_after_buy:double";
		String schemaStr18 = "brand_id:string,f1_0:bigint,f1_1:bigint,f1_2:bigint,f1_3:bigint,f2_0:bigint,f2_1:bigint,f2_2:bigint,f2_3:bigint,f3_0:bigint,f3_1:bigint,f3_2:bigint,f3_3:bigint,f4_0:bigint,f4_1:bigint,f4_2:bigint,f4_3:bigint,f5_0:bigint,f5_1:bigint,f5_2:bigint,f5_3:bigint,f6_0:bigint,f6_1:bigint,f6_2:bigint,f6_3:bigint,f7_0:bigint,f7_1:bigint,f7_2:bigint,f7_3:bigint,f8_0:bigint,f8_1:bigint,f8_2:bigint,f8_3:bigint,f9_0:bigint,f9_1:bigint,f9_2:bigint,f9_3:bigint,f10_0:bigint,f10_1:bigint,f10_2:bigint,f10_3:bigint,f11_0:bigint,f11_1:bigint,f11_2:bigint,f11_3:bigint,f12_0:bigint,f12_1:bigint,f12_2:bigint,f12_3:bigint,f13_0:bigint,f13_1:bigint,f13_2:bigint,f13_3:bigint,f14_0:bigint,f14_1:bigint,f14_2:bigint,f14_3:bigint,f15_0:bigint,f15_1:bigint,f15_2:bigint,f15_3:bigint,f16_0:bigint,f16_1:bigint,f16_2:bigint,f16_3:bigint,f17_0:bigint,f17_1:bigint,f17_2:bigint,f17_3:bigint,f18_0:bigint,f18_1:bigint,f18_2:bigint,f18_3:bigint,click_before_buy:double,favorite_before_buy:double,cart_before_buy:double,click_after_buy:double,favorite_after_buy:double,cart_after_buy:double,time_between_buy:double,time_after_buy:double";
		String schemaStr16 = "brand_id:string,f1_0:bigint,f1_1:bigint,f1_2:bigint,f1_3:bigint,f2_0:bigint,f2_1:bigint,f2_2:bigint,f2_3:bigint,f3_0:bigint,f3_1:bigint,f3_2:bigint,f3_3:bigint,f4_0:bigint,f4_1:bigint,f4_2:bigint,f4_3:bigint,f5_0:bigint,f5_1:bigint,f5_2:bigint,f5_3:bigint,f6_0:bigint,f6_1:bigint,f6_2:bigint,f6_3:bigint,f7_0:bigint,f7_1:bigint,f7_2:bigint,f7_3:bigint,f8_0:bigint,f8_1:bigint,f8_2:bigint,f8_3:bigint,f9_0:bigint,f9_1:bigint,f9_2:bigint,f9_3:bigint,f10_0:bigint,f10_1:bigint,f10_2:bigint,f10_3:bigint,f11_0:bigint,f11_1:bigint,f11_2:bigint,f11_3:bigint,f12_0:bigint,f12_1:bigint,f12_2:bigint,f12_3:bigint,f13_0:bigint,f13_1:bigint,f13_2:bigint,f13_3:bigint,f14_0:bigint,f14_1:bigint,f14_2:bigint,f14_3:bigint,f15_0:bigint,f15_1:bigint,f15_2:bigint,f15_3:bigint,f16_0:bigint,f16_1:bigint,f16_2:bigint,f16_3:bigint,click_before_buy:double,favorite_before_buy:double,cart_before_buy:double,click_after_buy:double,favorite_after_buy:double,cart_after_buy:double,time_between_buy:double,time_after_buy:double";
		String schemaStr14 = "brand_id:string,f1_0:bigint,f1_1:bigint,f1_2:bigint,f1_3:bigint,f2_0:bigint,f2_1:bigint,f2_2:bigint,f2_3:bigint,f3_0:bigint,f3_1:bigint,f3_2:bigint,f3_3:bigint,f4_0:bigint,f4_1:bigint,f4_2:bigint,f4_3:bigint,f5_0:bigint,f5_1:bigint,f5_2:bigint,f5_3:bigint,f6_0:bigint,f6_1:bigint,f6_2:bigint,f6_3:bigint,f7_0:bigint,f7_1:bigint,f7_2:bigint,f7_3:bigint,f8_0:bigint,f8_1:bigint,f8_2:bigint,f8_3:bigint,f9_0:bigint,f9_1:bigint,f9_2:bigint,f9_3:bigint,f10_0:bigint,f10_1:bigint,f10_2:bigint,f10_3:bigint,f11_0:bigint,f11_1:bigint,f11_2:bigint,f11_3:bigint,f12_0:bigint,f12_1:bigint,f12_2:bigint,f12_3:bigint,f13_0:bigint,f13_1:bigint,f13_2:bigint,f13_3:bigint,f14_0:bigint,f14_1:bigint,f14_2:bigint,f14_3:bigint,click_before_buy:double,favorite_before_buy:double,cart_before_buy:double,click_after_buy:double,favorite_after_buy:double,cart_after_buy:double,time_between_buy:double,time_after_buy:double";
		String schemaStr12 = "brand_id:string,f1_0:bigint,f1_1:bigint,f1_2:bigint,f1_3:bigint,f2_0:bigint,f2_1:bigint,f2_2:bigint,f2_3:bigint,f3_0:bigint,f3_1:bigint,f3_2:bigint,f3_3:bigint,f4_0:bigint,f4_1:bigint,f4_2:bigint,f4_3:bigint,f5_0:bigint,f5_1:bigint,f5_2:bigint,f5_3:bigint,f6_0:bigint,f6_1:bigint,f6_2:bigint,f6_3:bigint,f7_0:bigint,f7_1:bigint,f7_2:bigint,f7_3:bigint,f8_0:bigint,f8_1:bigint,f8_2:bigint,f8_3:bigint,f9_0:bigint,f9_1:bigint,f9_2:bigint,f9_3:bigint,f10_0:bigint,f10_1:bigint,f10_2:bigint,f10_3:bigint,f11_0:bigint,f11_1:bigint,f11_2:bigint,f11_3:bigint,f12_0:bigint,f12_1:bigint,f12_2:bigint,f12_3:bigint,click_before_buy:double,favorite_before_buy:double,cart_before_buy:double,click_after_buy:double,favorite_after_buy:double,cart_after_buy:double,time_between_buy:double,time_after_buy:double";

		// TODO: specify map output types
		job.setMapOutputKeySchema(SchemaUtils.fromString("flag:bigint,user_id:string"));
		job.setMapOutputValueSchema(SchemaUtils.fromString(schemaStr22));

		// TODO: specify input and output tables
		String inputTable = "t_4p1_feature_22";
		String outputTable = "t_4p1_feature_pair_user_22_expand_user_all";
		InputUtils
				.addTable(TableInfo.builder().tableName(inputTable).build(), job);
		OutputUtils.addTable(TableInfo.builder().tableName(outputTable).build(),
				job);

		job.setMapperClass(com.guosheng.featureExtraction.CalUserFeatureMap.class);
		job.setReducerClass(com.guosheng.featureExtraction.CalUserFeatureReduce.class);

		RunningJob rj = JobClient.runJob(job);
		rj.waitForCompletion();
	}

}
